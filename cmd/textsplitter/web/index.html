<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TextSplitter for Copilot</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Segoe UI Variable', Roboto, sans-serif;
            line-height: 1.6;
            color: #f5f5f5;
            background: #1e1e1e;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: #2d2d30;
            border-radius: 12px;
            border: 1px solid #3c3c3c;
            overflow: hidden;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
        }

        .header {
            background: #252526;
            color: #f5f5f5;
            padding: 24px 32px;
            border-bottom: 1px solid #3c3c3c;
        }

        .header h1 {
            font-size: 1.75rem;
            margin-bottom: 8px;
            font-weight: 600;
            color: #ffffff;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .header p {
            font-size: 0.95rem;
            color: #cccccc;
        }

        .copilot-icon {
            width: 28px;
            height: 28px;
            background: linear-gradient(135deg, #ff6b00 0%, #ff8c00 50%, #ffa500 100%);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 16px;
        }

        .main {
            padding: 32px;
        }

        .input-section {
            margin-bottom: 32px;
        }

        .control-bar {
            display: flex;
            align-items: center;
            gap: 24px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            padding: 16px 20px;
            background: #252526;
            border-radius: 8px;
            border: 1px solid #3c3c3c;
        }

        .chunk-size-control {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .chunk-size-control label {
            font-weight: 500;
            color: #cccccc;
            font-size: 0.9rem;
        }

        .chunk-size-control input {
            width: 100px;
            padding: 8px 12px;
            border: 1px solid #3c3c3c;
            border-radius: 6px;
            font-size: 0.9rem;
            text-align: center;
            background: #1e1e1e;
            color: #f5f5f5;
        }

        .chunk-size-control input:focus {
            outline: none;
            border-color: #ff8c00;
            box-shadow: 0 0 0 2px rgba(255, 140, 0, 0.1);
        }

        .whitespace-control {
            display: flex;
            align-items: center;
        }

        .whitespace-control label {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            color: #cccccc;
        }

        .compact-checkbox {
            width: 16px;
            height: 16px;
            border: 1px solid #3c3c3c;
            border-radius: 3px;
            background: #1e1e1e;
            cursor: pointer;
            position: relative;
        }

        .compact-checkbox:checked {
            background: #ff8c00;
            border-color: #ff8c00;
        }

        .compact-checkbox:checked::after {
            content: '✓';
            position: absolute;
            top: -1px;
            left: 2px;
            color: white;
            font-size: 12px;
            font-weight: bold;
        }

        .compact-label {
            user-select: none;
        }

        .stats {
            font-size: 0.85rem;
            color: #999999;
            font-weight: 400;
        }

        .textarea-container {
            position: relative;
        }

        #inputText {
            width: 100%;
            min-height: 200px;
            padding: 20px;
            border: 1px solid #3c3c3c;
            border-radius: 8px;
            font-size: 0.9rem;
            line-height: 1.5;
            font-family: 'Cascadia Code', 'Fira Code', 'SF Mono', Monaco, monospace;
            resize: vertical;
            transition: border-color 0.2s ease;
            background: #1e1e1e;
            color: #f5f5f5;
        }

        #inputText:focus {
            outline: none;
            border-color: #ff8c00;
            box-shadow: 0 0 0 2px rgba(255, 140, 0, 0.1);
        }

        #inputText::placeholder {
            color: #666666;
        }

        .action-buttons {
            display: flex;
            gap: 12px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            font-family: inherit;
        }

        .btn-primary {
            background: linear-gradient(135deg, #ff6b00 0%, #ff8c00 100%);
            color: white;
            border: 1px solid transparent;
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, #ff8c00 0%, #ffa500 100%);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(255, 140, 0, 0.3);
        }

        .btn-secondary {
            background: #3c3c3c;
            color: #cccccc;
            border: 1px solid #525252;
        }

        .btn-secondary:hover {
            background: #484848;
            color: #ffffff;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        .output-section {
            display: none;
            margin-top: 32px;
        }

        .output-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 1px solid #3c3c3c;
        }

        .output-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: #ffffff;
        }

        .output-stats {
            font-size: 0.85rem;
            color: #999999;
            font-weight: 400;
        }

        .chunks-container {
            display: grid;
            gap: 20px;
        }

        .chunk {
            background: #252526;
            border: 1px solid #3c3c3c;
            border-radius: 8px;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .chunk:hover {
            border-color: #ff8c00;
            box-shadow: 0 2px 8px rgba(255, 140, 0, 0.1);
        }

        .chunk.completed {
            opacity: 0.5;
            background: #1e1e1e;
            border-color: #10b981;
            transform: scale(0.98);
        }

        .chunk.completed:hover {
            border-color: #10b981;
            box-shadow: 0 2px 8px rgba(16, 185, 129, 0.1);
        }

        .chunk-header {
            background: linear-gradient(135deg, #ff6b00 0%, #ff8c00 100%);
            color: white;
            padding: 12px 16px;
            font-weight: 500;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.9rem;
        }

        .chunk.completed .chunk-header {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }

        .chunk-controls {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .chunk-checkbox {
            appearance: none;
            width: 18px;
            height: 18px;
            border: 2px solid rgba(255, 255, 255, 0.6);
            border-radius: 3px;
            cursor: pointer;
            position: relative;
            transition: all 0.2s ease;
        }

        .chunk-checkbox:checked {
            background: #ffffff;
            border-color: #ffffff;
        }

        .chunk-checkbox:checked::after {
            content: '✓';
            position: absolute;
            top: -2px;
            left: 2px;
            color: #10b981;
            font-size: 14px;
            font-weight: bold;
        }

        .chunk-content {
            padding: 20px;
            font-family: 'Cascadia Code', 'Fira Code', 'SF Mono', Monaco, monospace;
            line-height: 1.5;
            white-space: pre-wrap;
            word-wrap: break-word;
            background: #1e1e1e;
            cursor: text;
            user-select: text;
            color: #f5f5f5;
            font-size: 0.85rem;
        }

        .copy-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: 500;
        }

        .copy-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .copy-btn.copied {
            background: #10b981;
            border-color: #10b981;
        }

        .instructions {
            background: #264038;
            border: 1px solid #10b981;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 24px;
        }

        .instructions h3 {
            color: #10b981;
            margin-bottom: 12px;
            font-weight: 600;
            font-size: 0.95rem;
        }

        .instructions p {
            color: #cccccc;
            margin-bottom: 8px;
            font-size: 0.85rem;
        }

        .instructions strong {
            color: #ffffff;
        }

        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 8px;
            }

            .main {
                padding: 20px;
            }

            .header {
                padding: 20px;
            }

            .header h1 {
                font-size: 1.5rem;
            }

            .control-bar {
                flex-direction: column;
                align-items: flex-start;
                gap: 16px;
            }

            .action-buttons {
                flex-direction: column;
            }

            .btn {
                width: 100%;
                justify-content: center;
            }
        }

        .loading {
            display: none;
            text-align: center;
            padding: 24px;
            color: #999999;
        }

        .loading.show {
            display: block;
        }

        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid #3c3c3c;
            border-radius: 50%;
            border-top-color: #ff8c00;
            animation: spin 1s ease-in-out infinite;
            margin-right: 8px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>
                <div class="copilot-icon">✂</div>
                TextSplitter for Copilot
            </h1>
            <p>Split large documents into chunks that fit within Microsoft Copilot's character limits</p>
        </div>

        <div class="main">
            <div class="input-section">
                <div class="control-bar">
                    <div class="chunk-size-control">
                        <label for="chunkSize">Chunk Size:</label>
                        <input type="number" id="chunkSize" value="3000" min="500" max="8000" step="100">
                        <span>characters</span>
                    </div>
                    <div class="whitespace-control">
                        <label>
                            <input type="checkbox" id="compactMode" class="compact-checkbox">
                            <span class="compact-label">Smart compression (YAML-aware, enabled by default)</span>
                        </label>
                    </div>
                    <div class="stats" id="inputStats">
                        Ready to split text
                    </div>
                    <div class="stats" id="compressionStats" style="display: none; color: #ff8c00; font-weight: 500;">
                        <!-- Compression savings will be shown here -->
                    </div>
                    <div class="stats" id="yamlDetectionStats" style="display: none; color: #10b981; font-weight: 500;">
                        <!-- YAML detection notice will be shown here -->
                    </div>
                </div>

                <div class="textarea-container">
                    <textarea 
                        id="inputText" 
                        placeholder="Paste your large text here...

This tool will intelligently split your text at sentence boundaries, paragraphs, or word breaks to maintain readability while staying within Copilot's character limits.

Perfect for:
• Large documents
• Research papers  
• Code files
• Any text over 8,000 characters

Just paste and click Split!"
                    ></textarea>
                </div>

                <div class="action-buttons">
                    <button class="btn btn-primary" id="splitBtn" disabled>
                        ✂️ Split Text
                    </button>
                    <button class="btn btn-secondary" id="clearBtn">
                        🔄 Clear
                    </button>
                    <button class="btn btn-secondary" id="pasteBtn">
                        📋 Paste from Clipboard
                    </button>
                </div>
            </div>

            <div class="loading" id="loading">
                <div class="loading-spinner"></div>
                Splitting text...
            </div>

            <div class="output-section" id="outputSection">
                <div class="instructions">
                    <h3>💡 How to use with Microsoft Copilot:</h3>
                    <p><strong>1.</strong> Copy each chunk below (use the copy buttons)</p>
                    <p><strong>2.</strong> Check the box next to each chunk as you copy it to track progress</p>
                    <p><strong>3.</strong> Paste into Copilot with context like:</p>
                    <p style="margin-left: 20px;">• "This is part 1/3 of a document. Please process and wait for remaining parts."</p>
                    <p style="margin-left: 20px;">• "This is part 2/3, continuing from the previous part."</p>
                    <p style="margin-left: 20px;">• "This is the final part 3/3. Please analyze the complete document."</p>
                </div>

                <div class="output-header">
                    <div class="output-title">📊 Split Results</div>
                    <div class="output-stats" id="outputStats"></div>
                </div>

                <div class="chunks-container" id="chunksContainer">
                    <!-- Chunks will be inserted here -->
                </div>
            </div>
        </div>
    </div>

    <script>
        const inputText = document.getElementById('inputText');
        const chunkSize = document.getElementById('chunkSize');
        const compactMode = document.getElementById('compactMode');
        const splitBtn = document.getElementById('splitBtn');
        const clearBtn = document.getElementById('clearBtn');
        const pasteBtn = document.getElementById('pasteBtn');
        const inputStats = document.getElementById('inputStats');
        const compressionStats = document.getElementById('compressionStats');
        const yamlDetectionStats = document.getElementById('yamlDetectionStats');
        const outputSection = document.getElementById('outputSection');
        const outputStats = document.getElementById('outputStats');
        const chunksContainer = document.getElementById('chunksContainer');
        const loading = document.getElementById('loading');

        // Set default checkbox state - enabled by default
        compactMode.checked = true;

        // Update stats as user types
        inputText.addEventListener('input', updateInputStats);
        chunkSize.addEventListener('input', updateInputStats);
        compactMode.addEventListener('change', updateInputStats);

        // Advanced whitespace compression function optimized for ALMs
        function compressWhitespace(text) {
            // Detect file type for specialized compression
            const isYAML = detectYAMLContent(text);
            
            // Detect code blocks first to preserve their formatting
            const codeBlocks = [];
            let modifiedText = text;
            
            // Preserve code blocks (both ``` and ` formats)
            modifiedText = modifiedText.replace(/(```[\s\S]*?```|`[^`\n]+`)/g, (match, block) => {
                const placeholder = `__CODE_BLOCK_${codeBlocks.length}__`;
                codeBlocks.push(block);
                return placeholder;
            });
            
            // Apply YAML-specific compression if detected
            if (isYAML) {
                modifiedText = compressYAML(modifiedText);
            }
            
            // Preserve intentional indentation in lists and code-like structures
            const preservedIndents = [];
            modifiedText = modifiedText.replace(/^([ \t]+)([*+-]|\d+\.|[a-zA-Z]\.|[ivxlcdm]+\.)/gm, (match, indent, marker) => {
                const placeholder = `__INDENT_${preservedIndents.length}__`;
                preservedIndents.push(indent);
                return placeholder + marker;
            });
            
            // Main compression logic
            modifiedText = modifiedText
                // Normalize line endings
                .replace(/\r\n/g, '\n')
                .replace(/\r/g, '\n')
                // Replace multiple spaces with single spaces
                .replace(/ {2,}/g, ' ')
                // Replace multiple tabs with single spaces
                .replace(/\t+/g, ' ')
                // Replace tabs with spaces
                .replace(/\t/g, ' ')
                // Remove trailing spaces from lines
                .replace(/ +$/gm, '')
                // Replace 3+ consecutive newlines with double newlines (preserve paragraph breaks)
                .replace(/\n{3,}/g, '\n\n')
                // Remove spaces around newlines
                .replace(/ *\n */g, '\n')
                // Trim leading and trailing whitespace from the entire text
                .trim();
            
            // Restore preserved indentation
            preservedIndents.forEach((indent, index) => {
                modifiedText = modifiedText.replace(`__INDENT_${index}__`, indent);
            });
            
            // Restore code blocks
            codeBlocks.forEach((block, index) => {
                modifiedText = modifiedText.replace(`__CODE_BLOCK_${index}__`, block);
            });
            
            return modifiedText;
        }

        // YAML content detection
        function detectYAMLContent(text) {
            const yamlIndicators = [
                /^version:\s*[\d.]+/m,
                /^apiVersion:/m,
                /^kind:/m,
                /^orbs:/m,
                /^jobs:/m,
                /^workflows:/m,
                /^parameters:/m,
                /^steps:/m,
                /^\s*-\s+name:/m,
                /^\s*-\s+run:/m,
                /^\s*type:\s*string/m,
                /^\s*default:/m
            ];
            
            return yamlIndicators.some(pattern => pattern.test(text));
        }

        // YAML-specific compression optimized for DevOps workflows
        function compressYAML(text) {
            return text
                // Core YAML structure abbreviations (universally recognized)
                .replace(/\bparameters\b/g, 'params')
                .replace(/\btype:\s*string\b/g, 'typ: str')
                .replace(/\btype:\s*boolean\b/g, 'typ: bool') 
                .replace(/\btype:\s*integer\b/g, 'typ: int')
                .replace(/\bdefault\b/g, 'def')
                .replace(/\bcommand\b/g, 'cmd')
                .replace(/\bworking_directory\b/g, 'work_dir')
                .replace(/\bworking-directory\b/g, 'work-dir')
                .replace(/\benvironment\b/g, 'env')
                
                // CircleCI-specific abbreviations
                .replace(/\bpipeline\.parameters\b/g, 'pipeline.params')
                .replace(/\bpersist_to_workspace\b/g, 'persist_ws')
                .replace(/\bstore_artifacts\b/g, 'store_arts')
                .replace(/\battach_workspace\b/g, 'attach_ws')
                .replace(/\bresource_class\b/g, 'resource')
                
                // GitHub Actions abbreviations
                .replace(/\buses:\s*actions\/checkout@/g, 'uses: checkout@')
                .replace(/\buses:\s*actions\/setup-node@/g, 'uses: setup-node@')
                .replace(/\buses:\s*actions\/setup-python@/g, 'uses: setup-py@')
                .replace(/\buses:\s*actions\/upload-artifact@/g, 'uses: upload@')
                .replace(/\buses:\s*actions\/download-artifact@/g, 'uses: download@')
                .replace(/\bruns-on\b/g, 'runs')
                
                // Docker/Kubernetes abbreviations  
                .replace(/\bapiVersion\b/g, 'api')
                .replace(/\bmetadata\b/g, 'meta')
                .replace(/\bnamespace\b/g, 'ns')
                .replace(/\bcontainers\b/g, 'ctrs')
                .replace(/\bvolumeMounts\b/g, 'mounts')
                .replace(/\bserviceAccount\b/g, 'svcAcct')
                
                // Common build/deployment terms
                .replace(/\bInstall dependencies\b/g, 'Install deps')
                .replace(/\bBuild application\b/g, 'Build app')
                .replace(/\bRun tests\b/g, 'Run tests')
                .replace(/\bDeploy to\b/g, 'Deploy')
                .replace(/\bTest executable\b/g, 'Test exec')
                .replace(/\bCreate archive\b/g, 'Archive')
                .replace(/\bCreate tarball\b/g, 'Tarball')
                .replace(/\bDownload and install\b/g, 'Install')
                .replace(/\bRun as a server\b/g, 'Run server')
                .replace(/\bRun as a client\b/g, 'Run client')
                
                // Common variable name compressions
                .replace(/\bCIRCLE_WORKING_DIRECTORY\b/g, 'CWD')
                .replace(/\bGITHUB_WORKSPACE\b/g, 'WORKSPACE')
                .replace(/\bRUNNER_WORKSPACE\b/g, 'RUNNER_WS')
                
                // Docker image abbreviations
                .replace(/\bnode:(\d+)/g, 'node:$1')
                .replace(/\bpython:(\d+)/g, 'py:$1')
                .replace(/\bubuntu:latest\b/g, 'ubuntu')
                .replace(/\balpine:latest\b/g, 'alpine')
                
                // Kubernetes resource abbreviations
                .replace(/\bDeployment\b/g, 'Deploy')
                .replace(/\bConfigMap\b/g, 'ConfigM')
                .replace(/\bSecretKeyRef\b/g, 'SecretRef')
                .replace(/\bPersistentVolume\b/g, 'PV')
                .replace(/\bPersistentVolumeClaim\b/g, 'PVC')
                
                // Terraform abbreviations
                .replace(/\bresource\s+"([^"]+)"\s+"([^"]+)"/g, 'res "$1" "$2"')
                .replace(/\bvariable\b/g, 'var')
                .replace(/\bprovider\b/g, 'prov')
                .replace(/\bterraform\b/g, 'tf');
        }

        function updateInputStats() {
            const text = inputText.value;
            const size = parseInt(chunkSize.value) || 3000;
            
            if (text.length === 0) {
                inputStats.textContent = 'Ready to split text';
                compressionStats.style.display = 'none';
                yamlDetectionStats.style.display = 'none';
                splitBtn.disabled = true;
                return;
            }

            // Check for YAML content and show detection notice
            const isYAML = detectYAMLContent(text);
            if (isYAML && compactMode.checked) {
                yamlDetectionStats.innerHTML = '🔧 YAML detected - applying enhanced DevOps compression';
                yamlDetectionStats.style.display = 'block';
            } else {
                yamlDetectionStats.style.display = 'none';
            }

            // Calculate compression savings if enabled
            let processedText = text;
            let compressionInfo = '';
            
            if (compactMode.checked) {
                processedText = compressWhitespace(text);
                const savedChars = text.length - processedText.length;
                const savedPercentage = ((savedChars / text.length) * 100).toFixed(1);
                
                if (savedChars > 0) {
                    compressionInfo = `💾 Compression: ${savedChars.toLocaleString()} characters saved (${savedPercentage}%)`;
                    compressionStats.innerHTML = compressionInfo;
                    compressionStats.style.display = 'block';
                } else {
                    compressionStats.style.display = 'none';
                }
            } else {
                compressionStats.style.display = 'none';
            }
            
            const effectiveLength = processedText.length;
            const estimatedChunks = Math.ceil(effectiveLength / size);
            
            inputStats.innerHTML = `
                📊 ${text.length.toLocaleString()} characters${compactMode.checked && processedText.length !== text.length ? ` → ${effectiveLength.toLocaleString()}` : ''} | 
                Estimated ${estimatedChunks} chunk${estimatedChunks !== 1 ? 's' : ''}
            `;
            splitBtn.disabled = false;
        }

        // Split text function
        function splitText(text, maxSize) {
            if (text.length <= maxSize) {
                return [text];
            }

            const chunks = [];
            let remaining = text;

            while (remaining.length > 0) {
                if (remaining.length <= maxSize) {
                    chunks.push(remaining);
                    break;
                }

                let breakPoint = maxSize;
                const chunk = remaining.substring(0, breakPoint);

                // Try to break at sentence boundary
                const lastSentence = Math.max(
                    chunk.lastIndexOf('.'),
                    chunk.lastIndexOf('!'),
                    chunk.lastIndexOf('?')
                );
                if (lastSentence !== -1 && lastSentence > maxSize / 2) {
                    breakPoint = lastSentence + 1;
                } else {
                    // Try paragraph boundary
                    const lastParagraph = chunk.lastIndexOf('\n\n');
                    if (lastParagraph !== -1 && lastParagraph > maxSize / 3) {
                        breakPoint = lastParagraph + 2;
                    } else {
                        // Try line boundary
                        const lastNewline = chunk.lastIndexOf('\n');
                        if (lastNewline !== -1 && lastNewline > maxSize / 3) {
                            breakPoint = lastNewline + 1;
                        } else {
                            // Try word boundary
                            const lastSpace = chunk.lastIndexOf(' ');
                            if (lastSpace !== -1 && lastSpace > maxSize / 2) {
                                breakPoint = lastSpace + 1;
                            }
                        }
                    }
                }

                chunks.push(remaining.substring(0, breakPoint).trim());
                remaining = remaining.substring(breakPoint).trim();
            }

            return chunks;
        }

        // Copy to clipboard function
        async function copyToClipboard(text, button) {
            try {
                await navigator.clipboard.writeText(text);
                const originalText = button.textContent;
                button.textContent = '✅ Copied!';
                button.classList.add('copied');
                
                setTimeout(() => {
                    button.textContent = originalText;
                    button.classList.remove('copied');
                }, 2000);
            } catch (err) {
                // Fallback for older browsers
                const textarea = document.createElement('textarea');
                textarea.value = text;
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
                
                button.textContent = '✅ Copied!';
                setTimeout(() => {
                    button.textContent = '📋 Copy';
                }, 2000);
            }
        }

        // Split button click handler
        splitBtn.addEventListener('click', () => {
            const text = inputText.value.trim();
            const size = parseInt(chunkSize.value) || 3000;

            if (!text) return;

            loading.classList.add('show');
            outputSection.style.display = 'none';

            // Small delay to show loading state
            setTimeout(() => {
                // Apply compression if enabled
                const processedText = compactMode.checked ? compressWhitespace(text) : text;
                const chunks = splitText(processedText, size);
                
                // Calculate compression info for display
                const originalLength = text.length;
                const compressedLength = processedText.length;
                const savedChars = originalLength - compressedLength;
                
                // Update stats
                let statsText = `✂️ ${chunks.length} chunk${chunks.length !== 1 ? 's' : ''}`;
                if (compactMode.checked && savedChars > 0) {
                    statsText += ` | 💾 ${savedChars.toLocaleString()} chars saved`;
                }
                statsText += ` | ${originalLength.toLocaleString()} total characters`;
                
                outputStats.innerHTML = statsText;

                // Clear previous chunks
                chunksContainer.innerHTML = '';

                // Create chunk elements
                chunks.forEach((chunk, index) => {
                    const chunkElement = document.createElement('div');
                    chunkElement.className = 'chunk';
                    
                    // Create header
                    const headerDiv = document.createElement('div');
                    headerDiv.className = 'chunk-header';
                    
                    const titleSpan = document.createElement('span');
                    titleSpan.textContent = `📄 PART ${index + 1}/${chunks.length} (${chunk.length} characters)`;
                    
                    const controlsDiv = document.createElement('div');
                    controlsDiv.className = 'chunk-controls';
                    
                    const checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.className = 'chunk-checkbox';
                    checkbox.title = 'Mark as copied';
                    checkbox.onchange = function() { toggleChunkCompleted(this); };
                    
                    const copyBtn = document.createElement('button');
                    copyBtn.className = 'copy-btn';
                    copyBtn.textContent = '📋 Copy';
                    copyBtn.onclick = function() { copyToClipboard(chunk, this); };
                    
                    controlsDiv.appendChild(checkbox);
                    controlsDiv.appendChild(copyBtn);
                    headerDiv.appendChild(titleSpan);
                    headerDiv.appendChild(controlsDiv);
                    
                    // Create content
                    const contentDiv = document.createElement('div');
                    contentDiv.className = 'chunk-content';
                    contentDiv.textContent = chunk;
                    
                    chunkElement.appendChild(headerDiv);
                    chunkElement.appendChild(contentDiv);
                    chunksContainer.appendChild(chunkElement);
                });

                loading.classList.remove('show');
                outputSection.style.display = 'block';
                outputSection.scrollIntoView({ behavior: 'smooth' });
            }, 300);
        });

        // Clear button
        clearBtn.addEventListener('click', () => {
            inputText.value = '';
            outputSection.style.display = 'none';
            compressionStats.style.display = 'none';
            yamlDetectionStats.style.display = 'none';
            updateInputStats();
            inputText.focus();
        });

        // Paste button
        pasteBtn.addEventListener('click', async () => {
            try {
                const text = await navigator.clipboard.readText();
                inputText.value = text;
                updateInputStats();
                inputText.focus();
            } catch (err) {
                alert('Unable to access clipboard. Please paste manually.');
                inputText.focus();
            }
        });

        // Toggle chunk completed state
        function toggleChunkCompleted(checkbox) {
            const chunk = checkbox.closest('.chunk');
            if (checkbox.checked) {
                chunk.classList.add('completed');
            } else {
                chunk.classList.remove('completed');
            }
        }

        // Make functions globally available
        window.copyToClipboard = copyToClipboard;
        window.toggleChunkCompleted = toggleChunkCompleted;

        // Initialize
        updateInputStats();
    </script>
</body>
</html>